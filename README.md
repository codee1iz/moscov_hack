–ü–æ–Ω—è–ª, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ numpy. –í–æ—Ç —Ä–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–æ–ª—å–∫–æ numpy –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
https://miro.com/welcomeonboard/YXA0Q0k2QWNlVWxzZElvcGxsWmNuMUFIMkx0aUhXUjRFZXZESHRsNlkrM3BNNzlGSEtRblFjTTZkQm5WY1I5aVdLdXY3Qm9aQlhJZ0w1YzlWYmJkUWY3ekhZOExCYVpFQ1pIUnRFZTV6RndBRWNERFI4OFJzbTRuNTJkbDdRdDZ0R2lncW1vRmFBVnlLcVJzTmdFdlNRPT0hdjE=?share_link_id=368805869281python
import numpy as np

def detect_traffic_light_color(image_path):
    # –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ numpy array
    with open(image_path, 'rb') as f:
        data = np.frombuffer(f.read(), dtype=np.uint8)
    
    # –î–ª—è JPEG –Ω—É–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –Ω–∞–π—Ç–∏ –Ω–∞—á–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö
    # –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É JPEG
    try:
        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –º–∞—Ä–∫–µ—Ä –Ω–∞—á–∞–ª–∞ —Å–∫–∞–Ω–∞ (FFDA)
        start_marker = bytes([0xFF, 0xDA])
        start_idx = data.tobytes().find(start_marker) + 2
        
        if start_idx > 2:
            # –ë–µ—Ä–µ–º —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –º–∞—Ä–∫–µ—Ä–∞ (–ø–µ—Ä–≤—ã–µ 10000 –±–∞–π—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)
            image_data = data[start_idx:start_idx + 10000]
        else:
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –º–∞—Ä–∫–µ—Ä, –±–µ—Ä–µ–º —Å–µ—Ä–µ–¥–∏–Ω—É —Ñ–∞–π–ª–∞ (–≥–¥–µ –æ–±—ã—á–Ω–æ –¥–∞–Ω–Ω—ã–µ)
            image_data = data[len(data)//3:2*len(data)//3]
    except:
        # –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
        image_data = data
    
    # –ê–Ω–∞–ª–∏–∑ –±–∞–π—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—â–µ–≥–æ —Ü–≤–µ—Ç–∞
    # –í JPEG –¥–∞–Ω–Ω—ã–µ —Å–∂–∞—Ç—ã, –Ω–æ –º—ã –º–æ–∂–µ–º –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤
    
    # –†–∞–∑–¥–µ–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ç—Ä–∏ –≥—Ä—É–ø–ø—ã (—É—Å–ª–æ–≤–Ω–æ R, G, B –∫–∞–Ω–∞–ª—ã)
    chunk_size = len(image_data) // 3
    if chunk_size == 0:
        return "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
    
    # –ë–µ—Ä–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–µ—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
    red_section = image_data[:chunk_size]
    green_section = image_data[chunk_size:2*chunk_size]
    blue_section = image_data[2*chunk_size:3*chunk_size]
    
    # –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
    red_avg = np.mean(red_section)
    green_avg = np.mean(green_section)
    blue_avg = np.mean(blue_section)
    
    print(f"–£—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: R={red_avg:.1f}, G={green_avg:.1f}, B={blue_avg:.1f}")
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π —Ü–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    if green_avg > red_avg + 20 and green_avg > blue_avg + 20:
        return "–ó–ï–õ–ï–ù–´–ô"
    elif red_avg > green_avg + 20 and red_avg > blue_avg + 20:
        return "–ö–†–ê–°–ù–´–ô"
    else:
        # –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –Ω–µ–±–æ–ª—å—à–∞—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É
        max_val = max(red_avg, green_avg, blue_avg)
        if max_val == green_avg:
            return "–ó–ï–õ–ï–ù–´–ô"
        elif max_val == red_avg:
            return "–ö–†–ê–°–ù–´–ô"
        else:
            return "–ù–ï–û–ü–†–ï–î–ï–õ–ï–ù"

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –∞–Ω–∞–ª–∏–∑ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –±–∞–π—Ç–æ–≤
def detect_color_histogram(image_path):
    with open(image_path, 'rb') as f:
        data = np.frombuffer(f.read(), dtype=np.uint8)
    
    # –°–æ–∑–¥–∞–µ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–∞–π—Ç–æ–≤
    hist, bins = np.histogram(data, bins=256, range=(0, 255))
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞—Ö
    # –í JPEG –≤—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–∞—Å—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —è—Ä–∫–∏–º —Ü–≤–µ—Ç–∞–º
    
    low_range = np.sum(hist[:85])    # 0-84
    mid_range = np.sum(hist[85:170]) # 85-169  
    high_range = np.sum(hist[170:])  # 170-255
    
    print(f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: –Ω–∏–∑–∫–∏–µ={low_range}, —Å—Ä–µ–¥–Ω–∏–µ={mid_range}, –≤—ã—Å–æ–∫–∏–µ={high_range}")
    
    # –ó–µ–ª–µ–Ω—ã–π —Å–≤–µ—Ç –æ–±—ã—á–Ω–æ –∏–º–µ–µ—Ç –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    # –ö—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø–∏–∫–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö
    if high_range > mid_range * 1.5 and high_range > low_range * 1.5:
        return "–ö–†–ê–°–ù–´–ô"
    elif mid_range > high_range and mid_range > low_range:
        return "–ó–ï–õ–ï–ù–´–ô"
    else:
        return "–ù–ï–û–ü–†–ï–î–ï–õ–ï–ù"

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–≤—É—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö
def test_images(red_image_path, green_image_path):
    print("=== –ê–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–¥–æ–º —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π ===")
    print(f"–ö—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ç–æ—Ñ–æ—Ä: {detect_traffic_light_color(red_image_path)}")
    print(f"–ó–µ–ª–µ–Ω—ã–π —Å–≤–µ—Ç–æ—Ñ–æ—Ä: {detect_traffic_light_color(green_image_path)}")
    
    print("\n=== –ê–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–¥–æ–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã ===")
    print(f"–ö—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ç–æ—Ñ–æ—Ä: {detect_color_histogram(red_image_path)}")
    print(f"–ó–µ–ª–µ–Ω—ã–π —Å–≤–µ—Ç–æ—Ñ–æ—Ä: {detect_color_histogram(green_image_path)}")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
# test_images('–∫—Ä–∞—Å–Ω—ã–π.jpg', '–∑–µ–ª–µ–Ω—ã–π.jpg')
–í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

JPEG —Å–∂–∞—Ç–∏–µ: –î–∞–Ω–Ω—ã–µ –≤ JPEG —Å–∂–∞—Ç—ã, –ø–æ—ç—Ç–æ–º—É –ø—Ä—è–º–æ–π –∞–Ω–∞–ª–∏–∑ –±–∞–π—Ç–æ–≤ –Ω–µ –¥–∞–µ—Ç —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ü–≤–µ—Ç–∞—Ö –ø–∏–∫—Å–µ–ª–µ–π.
# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞ *moscov\_hack* (–¥–ª—è —á–∞–π–Ω–∏–∫–æ–≤)

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É `agts-ats`**
   –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ PowerShell:

   ```powershell
   powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
   uv sync
   ```

2. **–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É `agts-client`**
   –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ:

   ```powershell
   powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
   uv sync
   ```

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

1. **–ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–º—É–ª—è—Ç–æ—Ä**
   –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É `LCT_0.8` –∏ –ø–∏—à–µ–º:

   ```bash
   ./twin.exe
   ```

2. **–ó–∞–ø—É—Å–∫–∞–µ–º ATS**
   –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É `agts-ats` –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º:

   ```bash
   uv run launcher.py --twin
   ```

3. **–ó–∞–ø—É—Å–∫–∞–µ–º –∫–ª–∏–µ–Ω—Ç**

   * –ú–æ–∂–Ω–æ —á–µ—Ä–µ–∑ Jupyter:

     ```bash
     uv run jupyter notebook
     ```

     ‚ö†Ô∏è –ù–æ —ç—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ.
   * –ü–æ—ç—Ç–æ–º—É –ª—É—á—à–µ –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `agts-client/src/whole_code.ipynb` –ø—Ä—è–º–æ –≤ **VS Code** (–Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è `.ipynb`).

---

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è

1. –í–Ω–æ—Å–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥ (—Å–º. –∫–∞—Ä—Ç–∏–Ω–∫–∏ ![`image.png`](image.png), ![image-2.png](image-2.png)).
2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —è–¥—Ä–æ**.
3. –°–Ω–æ–≤–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –≤—Å—ë **—Å—Ç—Ä–æ–≥–æ –≤ —Ç–æ–π –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**:

   1. `LCT_0.8 ‚Üí ./twin.exe`
   2. `agts-ats ‚Üí uv run launcher.py --twin`
   3. `agts-client ‚Üí whole_code.ipynb` (–≤ VS Code)

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

* –í—Å–µ–≥–¥–∞ —Å–æ–±–ª—é–¥–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ —à–∞–≥–æ–≤!
* –ü–æ—Å–ª–µ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–≥–∏–∫–∏ ‚Üí –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —è–¥—Ä–∞ –∏ –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤—ã—à–µ.

---

–•–æ—á–µ—à—å, —è –µ—â—ë –¥–æ–±–∞–≤–ª—é –±–ª–æ–∫-—Å—Ö–µ–º—É (—Å—Ö–µ–º–∞—Ç–∏—á–∫—É) –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —à–∞–≥–æ–≤, —á—Ç–æ–±—ã –±—ã–ª–æ —Å–æ–≤—Å–µ–º –Ω–∞–≥–ª—è–¥–Ω–æ?
